{"version":3,"sources":["nubank/workspaces/ui/cursor.cljs"],"mappings":";;;;AAMA,sCAAA,tCAAMA,oFAASC,EAAEC;AAAjB,AACE,sEAAKA,/CAAE,AAACC,6CAAKF,7DAAGG;;AAElB,uCAAA,vCAAMC,sFAAUC,QAAQC;AAAxB,AACE,IAAMC,QAAM,AAAUD,cAAMD;AAA5B,AACE,GAAI,6CAAA,7CAACG,kDAAKD;AACR,OAACJ,gBAAMG;;AACP,IAAMG,aAAW,AAACC,gBAAMJ;IAClBK,2BAAe,EAAI,6CAAA,7CAACH,iDAAID,QACP,cAAA,bAAKE,kBACL,SAAA,RAAKF,7FACP,AAACK,2GAAIH;AAJ1B,AAKE,OAACV,oCAAQY,WAAWL;;;AAE5B,uCAAA,vCAAMO,sFAAUR,QAAQC;AAAxB,AACE,IAAMQ,iBAAe,AAAUR,cAAMD;AAArC,AACE,GAAI,6CAAA,7CAACG,kDAAKM;AACR,OAACX,gBAAMG;;AACP,IAAMG,aAAW,AAACC,gBAAMJ;IAClBK,2BAAe,mFAAA,jFAAI,AAACH,6CAAEM,eAAe,cAAA,bAAKL,wBAEzB,kBAAA,jBAAKK,tGACP,AAACF,6HAAIH;AAJ1B,AAKE,OAACV,oCAAQY,WAAWL;;;AAE5B,wCAAA,xCAAMS,wFAAWC,QAAQC,UAAUC;AAAnC,AACE,oBAAIA;AACF,GAAA,GAAQ,EAAA,mKAAA,lKAAI,kEAAA,lEAACC,wDAASF,0BACZ,6DAAA,oBAAA,6DAAA,9IAACE,iFAAAA,zBAASD,iFAAAA,qBACV,CAAG,kEAAA,lEAACC,wDAASF,yBAAuB,kEAAA,lEAACE,wDAASF;AACtD,GAAI,AAACT,6CAAE,AAACY,eAAKJ,SAASK;AACpB,yEAAA,lEAACC,wDAASL,sBAA0B,kEAAA,lEAACE,wDAASF;;AAC9C,yEAAA,lEAACK,wDAASL,sBAA0B,6DAAA,7DAACE,wDAASD;;;AALlD;;;AADF;;;AAQF,0CAAA,1CAAMK,4FAAaP,QAAQC,UAAUC;AAArC,AACE,oBAAIA;AACF,IAAMM,cAAY,CAAG,6DAAA,7DAACL,wDAASD,oBACX,6DAAA,7DAACC,wDAASD;AAD9B,AAEE,GAAA,GAAQ,EAAA,qGAAA,pGAAI,kEAAA,lEAACC,wDAASF,0BACZO,mBAAAA,eACA,CAAG,kEAAA,lEAACL,wDAASF,yBAAuB,kEAAA,lEAACE,wDAASF;AACtD,GAAI,AAACT,6CAAE,AAACL,gBAAMa,SAASK;AACrB,yEAAA,YAAA,9EAACC,wDAASL;;AACV,yEAAA,lEAACK,wDAASL,uBAA0BO,DACA,eAAG,kEAAA,lEAACL,wDAASF;;;AANrD;;;AAHJ;;;AAWF,wCAAA,xCAAMQ,wFAAWC;AAAjB,AACE,oDAAA,7CAACC,gFAAQ,AAACC,+CAAO,AAACC,6CAAKC,oBAAU3B,kBAAQuB;;AAE3C,AAAA,AAAA;AAAA,IAAAK,+BAAA,2CAAA,mDAAA,mFAAA,mFAAA,kEAAA,2CAAA,6DAAA,OAAA,sDAAA,IAAA,8DAAA,mCAAA,8EASQ,WAAKsB;AAAL,AACE,IAAAM,aAA0C,CAACzB,wEAAAA,+EAAAA,TAASmB,2DAAAA;IAApDM,iBAAA,AAAAxB,4BAAAwB;cAAA,AAAAvB,4CAAAuB,eAAA,rEAAe3C;YAAf,AAAAoB,4CAAAuB,eAAA,nEAAuBC;oBAAvB,AAAAxB,4CAAAuB,eAAA,3EAA6BF;AAA7B,AACE,OAAClC,wCAAYP,QACA,8DAAA,9DAACG,wDAASkC,mBACV,AAAClC,wDAASkC,MAAK,CAAA,oDAAa,CAACI,8CAAAA,qDAAAA,TAAWG,iCAAAA;GAbjE,0DAAA,4DACGP;AADH,AAAA,OAAArB,uDAAA,NACGqB;AADH,AAAA,IAAApB,aAAA,CAAAC,wEAAAA,+EAAAA,TACGmB,2DAAAA;IADHpB,iBAAA,AAAAE,4BAAAF;YAAAA,RAIWP;cAJX,AAAAU,4CAAAH,eAAA,rEAEYjB;cAFZ,AAAAoB,4CAAAH,eAAA,rEAEoBqB;gBAFpB,AAAAlB,4CAAAH,eAAA,vEAE4BsB;gBAF5B,AAAAnB,4CAAAH,eAAA,vEAEsCuB;oBAFtC,AAAApB,4CAAAH,eAAA,3EAEgDwB,iMACzBC;AAHvB,AAcE,2IAAA,pIAACG,sMAAoB,AAACpC,sCAAU,oDAAA,mDAAA,WAAAqC,lHAACC,8CAAMrC;AAAP,AAAmB,qEAAA,YAAAoC,1EAACxC,wDAAS+B;KAC3D,AAACW,yCACC,2DAAA,oHAAA,uDAAA,tOAACD,qDAAMrC,+RAGL,WAAKuC;AAAL,AACE,AAAiBA;;AACjB,IAAAC,aAA+B,CAAChC,wEAAAA,+EAAAA,TAASmB,2DAAAA;IAAzCa,iBAAA,AAAA/B,4BAAA+B;YAAA,AAAA9B,4CAAA8B,eAAA,nEAAeN;kBAAf,AAAAxB,4CAAA8B,eAAA,zEAAqBlD;IACfmD,OAAU,AAAC/D,qCAASwD,MAAM5C;IAC1BC,YAAU,8DAAA,9DAACE,wDAASkC;IACpBnC,OAAU,AAACC,wDAASkC,MAAK,CAAA,oDAAa,CAACI,8CAAAA,oDAAAA,RAAWU,gCAAAA;AAHxD,AAIE,oBAAM,iBAAAC,oBAAKnD;AAAL,AAAA,oBAAAmD;AAAelD;;AAAfkD;;;AAAN,AACE,AAACrD,sCAAUC,YAAQC,UAAUC;;AAC7B,QAACqC,0CAAAA,kDAAAA,VAAUY,8BAAAA,zBAAKF,8BAAAA;;AAFlB;;UAIR,AAACD,yCACC,2DAAA,oHAAA,yDAAA,xOAACD,qDAAMrC,iSAGL,WAAKuC;AAAL,AACE,AAAiBA;;AACjB,IAAAI,aAA+B,CAACnC,wEAAAA,+EAAAA,TAASmB,2DAAAA;IAAzCgB,iBAAA,AAAAlC,4BAAAkC;YAAA,AAAAjC,4CAAAiC,eAAA,nEAAeT;kBAAf,AAAAxB,4CAAAiC,eAAA,zEAAqBrD;IACfmD,OAAY,AAACtD,qCAAS+C,MAAM5C;IAC5BC,YAAY,8DAAA,9DAACE,wDAASkC;IACtBnC,OAAY,AAACC,wDAASkC,MAAK,CAAA,oDAAa,CAACI,8CAAAA,oDAAAA,RAAWU,gCAAAA;AAH1D,AAIE,oBAAM,iBAAAC,oBAAKnD;AAAL,AAAA,oBAAAmD;AAAelD;;AAAfkD;;;AAAN,AACE,AAAC7C,wCAAYP,YAAQC,UAAUC;;AAC/B,QAACqC,0CAAAA,kDAAAA,VAAUY,8BAAAA,zBAAKF,8BAAAA;;AAFlB;;UAIR,AAACD,yCACC,2DAAA,oHAAA,2DAAA,8GAAA,WAAAM,nWAACP,qDAAMrC;AAAP,AAEuB,IAAA6C,WAAW,AAAA,0IAAA,+IAAIlB,2DAAAA,zMAAKnB,wEAAAA,+EAAAA;IAApBsC,WAAAF;AAAA,AAAA,0FAAAC,SAAAC,gCAAAD,SAAAC,pIAAChB,0CAAAA,6DAAAA;UAE1B,AAACQ,yCACC,2DAAA,oHAAA,2DAAA,8GAAA,WAAAS,nWAACV,qDAAMrC;AAAP,AAEuB,0FAAA,KAAA+C,wCAAA,KAAAA,pIAACjB,0CAAAA,iEAAAA;UAE1B,iBAAAkB,qBAAA,0EAAAC;AAAA,AAAA,YAAAC,kBAAA,KAAA;AAAA,AAAA,IAAAD,eAAAA;;AAAA,AAAA,IAAAE,qBAAA,AAAAC,cAAAH;AAAA,AAAA,GAAAE;AAAA,AAAA,IAAAF,eAAAE;AAAA,AAAA,GAAA,AAAAE,6BAAAJ;AAAA,IAAAK,kBAk1E+C,AAAAiB,sBAAAtB;IAl1E/CM,qBAAA,AAAAvE,gBAAAsE;IAAAE,WAAA,AAAAC,uBAAAF;AAAA,AAAA,GAAA,AAAA,iBAAAG,WAAA;;AAAA,AAAA,GAAA,CAAAA,WAAAH;AAAA,QAAA,AAAAI,eAAAL,gBAAAI,nCAAMS;AAAN,AAAA,AAAA,AAAAP,uBAAAJ,SACE,oIAAA,2CAAA,gLAAA,mDAAA,lZAACrB,mOAAc,CAACJ,8CAAAA,iDAAAA,LAAWoC,6BAAAA;kBAA3BC;AAAA,AACgB,iQAAAA,1PAACxE,wDAAS+B,MAAK,CAAA,oDAAa,CAACI,8CAAAA,iDAAAA,LAAWoC,6BAAAA;;SACtD,CAACvC,wCAAAA,2CAAAA,LAAQuC,uBAAAA;;AAHb,eAAA,CAAAT,WAAA;;;;AAAA;;;;;AAAA,OAAAG,qBAAA,AAAAC,gBAAAN,UAAA,AAAAO,gEAAA,AAAAC,qBAAAf;;AAAA,OAAAY,qBAAA,AAAAC,gBAAAN,UAAA;;;AAAA,QAAA,AAAA/E,gBAAAwE,pBAAMkB;AAAN,AAAA,OAAAF,eACE,oIAAA,2CAAA,gLAAA,mDAAA,lZAAC9B,mOAAc,CAACJ,8CAAAA,iDAAAA,LAAWoC,6BAAAA;kBAA3BC;AAAA,AACgB,iQAAAA,1PAACxE,wDAAS+B,MAAK,CAAA,oDAAa,CAACI,8CAAAA,iDAAAA,LAAWoC,6BAAAA;;yHAF1D,AAAAJ,gEAAA,AAAAG,eAAAjB,/LAGI,CAACrB,wCAAAA,2CAAAA,LAAQuC,uBAAAA;;;AAHb;;;;GAAA,KAAA;;AAAA,AAAA,OAAAnB,mBAAQ1D;;;;AArDZ,AAAA,GAAA,QAAAqB,mCAAAC,8CAAAC,iDAAAC,wDAAAC;AAAA;AAAA,AAAA;;;6CAAA,qDAAAC,lGAAUU;AAAV,AAAA,IAAAT,sBAAA;AAAA,AAAA,IAAAC,2BAAA,AAAAR,4CAAAL,6BAAA;AAAA,AAAA,oBAAAa;AAAA,IAAAC,kCAAAD;AAAA,AAAA,CAAA,AAAAD,4BAAA,iBAAAG,WAAA,EAAA,eAAA,iBAAAC,WAAAJ;IAAAK,WAAA,CAAAC,yEAAAA,uEAAAP,qBAAA,kBAAAO,mDAAAP,qBAAA;AAAA,AAAA,QAAAG,gEAAAA,8DAAAE,SAAAC,YAAAH,0CAAAE,SAAAC;;AAAA,AAAAF;;;AAAA,CAAA,AAAAH,4BAAA,iBAAAO,WAAA,EAAA,eAAA;AAAA,AAAAA;;;;AAAA;;;;AAAA,AAAAC,uGAAA,8HAAApB,zKAAUqB;AA0DV,AAAK2C,8CAAgB,AAACC,wEAAW5C","names":["nubank.workspaces.ui.cursor/get-nth","i","s","cljs.core.drop","cljs.core/first","nubank.workspaces.ui.cursor/seq-prev","current","items","index","cljs.core._EQ_","item-count","cljs.core/count","next-index","cljs.core/mod","nubank.workspaces.ui.cursor/seq-next","selected-index","nubank.workspaces.ui.cursor/scroll-up","options","container","item","nubank.workspaces.ui.cursor.goog$module$goog$object.get","cljs.core/last","cljs.core/next","nubank.workspaces.ui.cursor.goog$module$goog$object.set","nubank.workspaces.ui.cursor/scroll-down","item-bottom","nubank.workspaces.ui.cursor/dom-props","props","cljs.core.into","cljs.core.remove","cljs.core.comp","cljs.core/namespace","options__48885__auto__","com.fulcrologic.fulcro.components/wrapped-render","map__59011","com.fulcrologic.fulcro.components/props","cljs.core/--destructure-map","cljs.core.get","js/nubank","js/nubank.workspaces","js/nubank.workspaces.ui","js/nubank.workspaces.ui.cursor","js/nubank.workspaces.ui.cursor.VerticalCursor","props__48886__auto__","this__48887__auto__","temp__5751__auto__","init-state__48888__auto__","obj59077","G__59078","G__59079","com.fulcrologic.fulcro.components/isoget","obj59084","com.fulcrologic.fulcro.components/configure-component!","nubank.workspaces.ui.cursor/VerticalCursor","this","factory","on-change","on-select","value->key","cljs.core/pr-str","map__59004","value","com.fulcrologic.fulcro_css.localized_dom.div","p1__58991#","cljs.core.assoc","nubank.workspaces.ui.events/dom-listener","e","map__59025","next","and__4251__auto__","map__59039","p1__58994#","G__59043","G__59044","p1__58995#","iter__4652__auto__","s__59050","cljs.core/LazySeq","temp__5753__auto__","cljs.core/seq","cljs.core/chunked-seq?","c__4650__auto__","size__4651__auto__","b__59052","cljs.core/chunk-buffer","i__59051","cljs.core/-nth","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__59049","cljs.core/chunk-rest","cljs.core/cons","cljs.core/rest","x","p1__58998#","nubank.workspaces.ui.cursor/vertical-cursor","com.fulcrologic.fulcro.components.factory","cljs.core/chunk-first"],"sourcesContent":["(ns nubank.workspaces.ui.cursor\n  (:require [com.fulcrologic.fulcro.components :as fp]\n            [com.fulcrologic.fulcro-css.localized-dom :as dom]\n            [nubank.workspaces.ui.events :as dom-events]\n            [goog.object :as gobj]))\n\n(defn get-nth [i s]\n  (->> s (drop i) first))\n\n(defn seq-prev [current items]\n  (let [index (.indexOf items current)]\n    (if (= -1 index)\n      (first items)\n      (let [item-count (count items)\n            next-index (-> (if (= 0 index)\n                             (dec item-count)\n                             (dec index))\n                           (mod item-count))]\n        (get-nth next-index items)))))\n\n(defn seq-next [current items]\n  (let [selected-index (.indexOf items current)]\n    (if (= -1 selected-index)\n      (first items)\n      (let [item-count (count items)\n            next-index (-> (if (= selected-index (dec item-count))\n                             0\n                             (inc selected-index))\n                           (mod item-count))]\n        (get-nth next-index items)))))\n\n(defn scroll-up [options container item]\n  (if item\n    (if-not (<= (gobj/get container \"scrollTop\")\n              (gobj/get item \"offsetTop\")\n              (+ (gobj/get container \"scrollTop\") (gobj/get container \"offsetHeight\")))\n      (if (= (last options) next)\n        (gobj/set container \"scrollTop\" (-> (gobj/get container \"scrollHeight\")))\n        (gobj/set container \"scrollTop\" (-> (gobj/get item \"offsetTop\")))))))\n\n(defn scroll-down [options container item]\n  (if item\n    (let [item-bottom (+ (gobj/get item \"offsetTop\")\n                        (gobj/get item \"scrollHeight\"))]\n      (if-not (<= (gobj/get container \"scrollTop\")\n                item-bottom\n                (+ (gobj/get container \"scrollTop\") (gobj/get container \"offsetHeight\")))\n        (if (= (first options) next)\n          (gobj/set container \"scrollTop\" 0)\n          (gobj/set container \"scrollTop\" (-> item-bottom\n                                              (- (gobj/get container \"offsetHeight\")))))))))\n\n(defn dom-props [props]\n  (into {} (remove (comp namespace first)) props))\n\n(fp/defsc VerticalCursor\n  [this\n   {::keys [options factory on-change on-select value->key]\n    :or    {value->key pr-str}\n    :as    props}]\n  {:css [[:.container {:overflow \"auto\"\n                       :flex     \"1\"\n                       :position \"relative\"}]]\n   :componentDidMount\n        (fn [this]\n          (let [{::keys [options value value->key]} (fp/props this)]\n            (scroll-down options\n                         (gobj/get this \"container\")\n                         (gobj/get this (str \"item-\" (value->key value))))))}\n  (dom/div :.container (dom-props (assoc props :ref #(gobj/set this \"container\" %)))\n    (dom-events/dom-listener\n      (assoc props\n        ::dom-events/keystroke \"up\"\n        ::dom-events/action\n        (fn [e]\n          (.preventDefault e)\n          (let [{::keys [value options]} (fp/props this)\n                next      (seq-prev value options)\n                container (gobj/get this \"container\")\n                item      (gobj/get this (str \"item-\" (value->key next)))]\n            (when (and container item)\n              (scroll-up options container item)\n              (on-change next e))))))\n\n    (dom-events/dom-listener\n      (assoc props\n        ::dom-events/keystroke \"down\"\n        ::dom-events/action\n        (fn [e]\n          (.preventDefault e)\n          (let [{::keys [value options]} (fp/props this)\n                next        (seq-next value options)\n                container   (gobj/get this \"container\")\n                item        (gobj/get this (str \"item-\" (value->key next)))]\n            (when (and container item)\n              (scroll-down options container item)\n              (on-change next e))))))\n\n    (dom-events/dom-listener\n      (assoc props\n        ::dom-events/keystroke \"return\"\n        ::dom-events/action #(on-select (-> this fp/props ::value) %)))\n\n    (dom-events/dom-listener\n      (assoc props\n        ::dom-events/keystroke \"escape\"\n        ::dom-events/action #(on-select nil %)))\n\n    (for [x options]\n      (dom/div {:key (value->key x)\n                :ref #(gobj/set this (str \"item-\" (value->key x)) %)}\n        (factory x)))))\n\n(def vertical-cursor (fp/factory VerticalCursor))\n"]}