{"version":3,"sources":["devcards/util/markdown.cljs"],"mappings":";AAKA,6CAAA,7CAAMA,kGAAqBC;AAA3B,AACE,IAAAC,qBAAc,AAACE,iBAAO,qBAAA,rBAACC,kCAA0BJ;AAAjD,AAAA,oBAAAC;AAAA,AAAA,SAAAA,LAAWC;AAAX,AACE,OAAUA;;AADZ;;;AAGF,+CAAA,/CAAMG,sGAAiBL;AAAvB,AAA0B,OAACM,mBAAQ,qBAAA,rBAACF,gDAAuCJ;;AAE3E;;;2CAAA,3CAAMO,8FACHC;AADH,AAEE,IAAAC,kQACOD,5FACH,AAACE,+CAAOL,tIACR,AAACM,4CAAIZ,xGACL,AAACa,8CAAMC;AAJX,AAAA,oBAAAJ;AAAAA;;AAAA;;;AAOF;;;2CAAA,3CAAMK,8FACHd,EAAEe;AADL,AAEE,GAAI,AAACV,6CAAgBL;AACnB,OAACgB,6CAAKhB,EAAEe;;AACR,OAACE,oBAAYjB;;;AAEjB,0CAAA,1CAAMkB,4FAAkBC;AAAxB,AACE,OAACC,eAAkBD;;AAErB,8CAAA,9CAAME,oGAAgBC;AAAtB,AACE,4BAAA,rBAAClB,wCAA+BkB;;AAElC,GAAA,QAAAC,qCAAAC,0CAAAC,mDAAAC;AAAA;AAAA,AAAA,sCAAA,iBAAAC,6BAAA,AAAAC,6CAAA,jIAAUS;IAAVR,6BAAA,AAAAD,6CAAA;IAAAE,6BAAA,AAAAF,6CAAA;IAAAG,iCAAA,AAAAH,6CAAA;IAAAI,0BAAA,AAAAC,4CAAA,mCAAA,gEAAA,iBAAAC,eAAA;AAAA,AAAA,QAAAA,6CAAAA,+CAAAA;;AAAA,AAAA,YAAAC,kBAAA,AAAAC,+CAAA,yBAAA,gBACE,WAAAE,SAAqBhB;AAArB,AAAA,IAAAiB,aAAAD;IAAAC,iBAAA,AAAAC,4BAAAD;YAAA,AAAAN,4CAAAM,eAAA,nEAAaE;AAAb,AAAA,0FACG,qEAAA,uDAAA,1GAAI,AAACpB,4CAAeC,mHAAoB,AAAA,mFAAOmB;GAFpD,4DAAAT,wBAAAL,2BAAAE,2BAAAC,2BAAAC;;;AAIA,AAAAM,gFAAA,mFAAA,oDAAA,qEAAA,WAAAK,SAA8EpB;AAA9E,AAAA,IAAAqB,aAAAD;IAAAC,iBAAA,AAAAH,4BAAAG;SAAAA,LAA0EE;YAA1E,AAAAZ,4CAAAU,eAAA,nEAAmDF;kBAAnD,AAAAR,4CAAAU,eAAA,zEAAyDC;AAAzD,AACE,4DAAA,mFAAA,uDAAA,/LAACE,kDAAUD,8MAAqBE,eAAK,AAACjC,yCAAkBQ,KAAKsB;;AAE/D,AAAAP,gFAAA,mFAAA,oDAAA,0EAAA,WAAAW,SAAoE1B;AAApE,AAAA,IAAA2B,aAAAD;IAAAC,iBAAA,AAAAT,4BAAAS;SAAAA,LAAgEJ;YAAhE,AAAAZ,4CAAAgB,eAAA,nEAAqDR;AAArD,AACE,4DAAA,mFAAA,uDAAA,/LAACK,kDAAUD,8MAAqBE,eAAK,AAAC/B,6CAAKM,KAAK,AAAA,uGAAiBmB;;AAEnE,AAAAJ,gFAAA,mFAAA,uDAAA,qEAAA,WAAAa,SAAyE5B;AAAzE,AAAA,IAAA6B,aAAAD;IAAAC,iBAAA,AAAAX,4BAAAW;SAAAA,LAAqEN;YAArE,AAAAZ,4CAAAkB,eAAA,nEAAoDV;YAApD,AAAAR,4CAAAkB,eAAA,nEAA0DC;AAA1D,AACE,IAAMC,OAAK,AAAClD,iBAAO,AAACkB,4CAAeC;AAAnC,mGACMuB,9CACF,iDAAA,jDAACS,yGAAa,AAACC,6CAAKH,MAAMX,jNAC1B,yNAAA,uDAAA,2CAAA,qDAAA,kEAAA,sGAAA,0HAAA,yDAAA,psBAACa,ieAEa,qCAAA,KAAA,xCAAU,AAACE,4BAAcH,YAAMA,+EACrB,AAACtD,2CAAoBuB;;AAGnD,AAAAe,gFAAA,mFAAA,uDAAA,0EAAA,WAAAoB,SAA2EnC;AAA3E,AAAA,IAAAoC,aAAAD;IAAAC,iBAAA,AAAAlB,4BAAAkB;SAAAA,LAAuEb;YAAvE,AAAAZ,4CAAAyB,eAAA,nEAAsDjB;YAAtD,AAAAR,4CAAAyB,eAAA,nEAA4DN;AAA5D,mGACMP,9CACF,iDAAA,jDAACS,yGAAa,AAACC,6CAAKH,MAAMX,jNAC1B,yNAAA,uDAAA,2CAAA,qDAAA,6DAAA,yDAAA,/dAACa;;AAEL,gDAAA,hDAAMK,wGAAmBC;AAAzB,AACE,IAAMpD,QAAM,qDAAA,rDAACqD,mDAAaD;AAA1B,AACE,0FAAA,2CAAA,uDAAA,2CAAA,qDAAA,6DAAA,yDAAA,yCAAA,wDAAA,iCAAA,7gBAACE,+CAAOzB,iiBACsD,AAAC9B,yCAAkBC,eAChFA;;AAEL,0CAAA,1CAAMuD,4FAAkBH;AAAxB,AACE,IAAAI,aAA4B,AAACL,8CAAkBC;IAA/CI,iBAAA,AAAAxB,4BAAAwB;YAAA,AAAA/B,4CAAA+B,eAAA,nEAAcvB;YAAd,AAAAR,4CAAA+B,eAAA,nEAAoBZ;AAApB,AAGI,OAACzC,4CAAI,WAAK0D;AAAL,AAAQ,2DAAA,mFAAA,iEAAA,WAAAC,nNAACxB,kDAAUuB;AAAX,AAAyB,yDAAA,KAAAC,vDAACC;;GADvC,AAAC7D,+CAAO,WAAAuD;AAAA,AAAA,IAAAC,aAAAD;IAAAC,iBAAA,AAAA1B,4BAAA0B;cAAA,AAAAjC,4CAAAiC,eAAA,rEAAaC;AAAb,AAAwB,OAACC,oBAAUD;GADxC,AAACZ,6CAAKH,MAAMX","names":["devcards.util.markdown/leading-space-count","s","temp__5753__auto__","ws","cljs.core/second","cljs.core/re-matches","devcards.util.markdown/is-bullet-item?","cljs.core/boolean","devcards.util.markdown/bullets-left-edge","lines","or__4253__auto__","cljs.core.filter","cljs.core.map","cljs.core.apply","cljs.core/min","devcards.util.markdown/strip-left-margin","margin","cljs.core.subs","clojure.string/trim","devcards.util.markdown/markdown-to-html","markdown-txt","js/DevcardsMarked","devcards.util.markdown/matches-delim?","line","js/devcards","js/devcards.util","js/devcards.util.markdown","js/devcards.util.markdown.block-parser","method-table__4747__auto__","cljs.core.atom","prefer-table__4748__auto__","method-cache__4749__auto__","cached-hierarchy__4750__auto__","hierarchy__4751__auto__","cljs.core.get","fexpr__50887","cljs.core/MultiFn","cljs.core.symbol","devcards.util.markdown/block-parser","p__50889","map__50891","cljs.core/--destructure-map","stage","p__50896","map__50902","left-margin","st","cljs.core.update_in","cljs.core/conj","p__50904","map__50905","p__50909","map__50910","accum","lang","cljs.core.assoc","cljs.core.conj","clojure.string/blank?","p__50913","map__50914","devcards.util.markdown/parse-out-blocks*","m","clojure.string.split","cljs.core.reduce","devcards.util.markdown/parse-out-blocks","map__50924","p__50925","map__50926","content","cljs.core/not-empty","x","p1__50921#","clojure.string.join"],"sourcesContent":["(ns devcards.util.markdown\n  (:require\n   [clojure.string :as string]\n   [devcards-marked :as devcards-marked]))\n\n(defn leading-space-count [s]\n  (when-let [ws (second (re-matches #\"^([\\s]*).*\"  s))]\n    (.-length ws)))\n\n(defn is-bullet-item? [s] (boolean (re-matches #\"^\\s*([-*+]|[0-9]+\\.)\\s.*\" s)))\n\n(defn bullets-left-edge \"Find the common left edge of bullet lists in a collection of lines.\"\n  [lines]\n  (or\n    (->> lines\n      (filter is-bullet-item?)\n      (map leading-space-count)\n      (apply min))\n    0))\n\n(defn strip-left-margin \"Strip the left margin's extra whitespace, but leave bullet list indents in tact.\"\n  [s margin]\n  (if (is-bullet-item? s)\n    (subs s margin)\n    (string/trim s)))\n\n(defn markdown-to-html [markdown-txt]\n  (js/DevcardsMarked markdown-txt))\n\n(defn matches-delim? [line]\n  (re-matches #\"^[\\s]*```(\\w*).*\" line))\n\n(defmulti block-parser\n  (fn [{:keys [stage]} line]\n    [(if (matches-delim? line) :delim :line) (:type stage)]))\n\n(defmethod block-parser [:line :markdown] [{:keys [stage left-margin] :as st} line]\n  (update-in st [:stage :content] conj (strip-left-margin line left-margin)))\n\n(defmethod block-parser [:line :code-block] [{:keys [stage] :as st} line]\n  (update-in st [:stage :content] conj (subs line (:leading-spaces stage))))\n\n(defmethod block-parser [:delim :markdown] [{:keys [stage accum] :as st} line];; enter block\n  (let [lang (second (matches-delim? line))]\n    (-> st ;; the beginning\n      (assoc :accum (conj accum stage))\n      (assoc :stage\n             {:type :code-block\n              :lang (when-not (string/blank? lang) lang)\n              :leading-spaces (leading-space-count line)\n              :content []}))))\n\n(defmethod block-parser [:delim :code-block] [{:keys [stage accum] :as st} line];; enter block\n  (-> st ;; the end\n    (assoc :accum (conj accum stage))\n    (assoc :stage {:type :markdown :content []})))\n\n(defn parse-out-blocks* [m]\n  (let [lines (string/split m \"\\n\")]\n    (reduce block-parser\n     {:stage {:type :markdown :content []} :accum [] :left-margin (bullets-left-edge lines)}\n     lines)))\n\n(defn parse-out-blocks [m]\n  (let [{:keys [stage accum]} (parse-out-blocks* m)]\n    (->> (conj accum stage)\n      (filter (fn [{:keys [content]}] (not-empty content)))\n      (map (fn [x] (update-in x [:content] #(string/join \"\\n\" %)))))))\n\n#_(devcards.core/defcard parse-out-code-blocks3\n  (parse-out-blocks\n   \"   ```langer\n   (defcard bmi-calculator                        ;; optional symbol name\n     \\\"*Code taken from Reagent readme.*\\\"          ;; optional markdown doc\n     (fn [data-atom _] (bmi-component data-atom)) ;; object of focus\n     {:height 180 :weight 80}                     ;; optional initial data\n     {:inspect-data true :history true})          ;; optional devcard config options\n      \n   ```\n# [Devcards](https://github.com/bhauman/devcards): the hard sell\n    \n   The Devcards library is intended to make ClojureScript development\n   a pure joy.\n \n   Devcards are intended to facilitate **interactive live\n   development**. Devcards can be used in conjunction with figwheel but\n   will also work with any form of live code reloading (repl, boot-reload, ...)\n\n   Devcards revolves around a multi-purpose macro called `defcard`.\n   You can think of `defcard` as a powerful form of **pprint** that helps you\n   interactively lift code examples out of your source files into the\n   Devcards interface (you are currently looking at the Devcards\n   interface).\n\n   The Devcards that you create are intended to have no impact on the\n   size of your production code. You can use Devcards just as you\n   would use exectuable comments inline with your source code. You\n   can also keep them separate like a test suite.\n\n   With [figwheel](https://github.com/bhauman/lein-figwheel), Devcards\n   configuration couldn't be simpler. Just add `[devcards\n   \\\"0.2.0-SNAPSHOT\\\"]` and create a new build config with `:figwheel\n   {:devcards true}`. See the Quick Start instructions at the end of\n   this document.\n\n   Let's look at an advanced Devcard:\n   \n   ```\n   (defcard bmi-calculator                        ;; optional symbol name\n     \\\"*Code taken from Reagent readme.*\\\"          ;; optional markdown doc\n     (fn [data-atom _] (bmi-component data-atom)) ;; object of focus\n     {:height 180 :weight 80}                     ;; optional initial data\n     {:inspect-data true :history true})          ;; optional devcard config options\n      \n   ```\n\n   The [defcard api](#!/devdemos.defcard_api)\n   is intended to be small and intuitive.\n\n   And you can see this devcard rendered below:\"))\n\n\n#_(devcards.core/defcard parse-out-code-blocks3\n  (parse-out-blocks\n   \"# [Devcards](https://github.com/bhauman/devcards): the hard sell\n    \n   The Devcards library is intended to make ClojureScript development\n   a pure joy.\n \n   Devcards are intended to facilitate **interactive live\n   development**. Devcards can be used in conjunction with figwheel but\n   will also work with any form of live code reloading (repl, boot-reload, ...)\n\n   Devcards revolves around a multi-purpose macro called `defcard`.\n   You can think of `defcard` as a powerful form of **pprint** that helps you\n   interactively lift code examples out of your source files into the\n   Devcards interface (you are currently looking at the Devcards\n   interface).\n\n   The Devcards that you create are intended to have no impact on the\n   size of your production code. You can use Devcards just as you\n   would use exectuable comments inline with your source code. You\n   can also keep them separate like a test suite.\n\n   With [figwheel](https://github.com/bhauman/lein-figwheel), Devcards\n   configuration couldn't be simpler. Just add `[devcards\n   \\\"0.2.0-SNAPSHOT\\\"]` and create a new build config with `:figwheel\n   {:devcards true}`. See the Quick Start instructions at the end of\n   this document.\n\n   Let's look at an advanced Devcard:\n   \n   ```\n   (defcard bmi-calculator                        ;; optional symbol name\n     \\\"*Code taken from Reagent readme.*\\\"          ;; optional markdown doc\n     (fn [data-atom _] (bmi-component data-atom)) ;; object of focus\n     {:height 180 :weight 80}                     ;; optional initial data\n     {:inspect-data true :history true})          ;; optional devcard config options\n      \n   ```\n\n   The [defcard api](#!/devdemos.defcard_api)\n   is intended to be small and intuitive.\n\n   And you can see this devcard rendered below:\"))\n"]}