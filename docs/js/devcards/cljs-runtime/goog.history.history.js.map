{
"version":3,
"file":"goog.history.history.js",
"lineCount":294,
"mappings":"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",
"sources":["goog/history/history.js"],
"sourcesContent":["/**\n * @license\n * Copyright The Closure Library Authors.\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Browser history stack management class.\n *\n * The goog.History object allows a page to create history state without leaving\n * the current document. This allows users to, for example, hit the browser's\n * back button without leaving the current page.\n *\n * The history object can be instantiated in one of two modes. In user visible\n * mode, the current history state is shown in the browser address bar as a\n * document location fragment (the portion of the URL after the '#'). These\n * addresses can be bookmarked, copied and pasted into another browser, and\n * modified directly by the user like any other URL.\n *\n * If the history object is created in invisible mode, the user can still\n * affect the state using the browser forward and back buttons, but the current\n * state is not displayed in the browser address bar. These states are not\n * bookmarkable or editable.\n *\n * It is possible to use both types of history object on the same page, but not\n * currently recommended due to browser deficiencies.\n *\n * Tested to work in:\n * <ul>\n *   <li>Firefox 1.0-4.0\n *   <li>Internet Explorer 5.5-9.0\n *   <li>Opera 9+\n *   <li>Safari 4+\n * </ul>\n *\n * @see ../demos/history1.html\n * @see ../demos/history2.html\n */\n\n/* Some browser specific implementation notes:\n *\n * Firefox (through version 2.0.0.1):\n *\n * Ideally, navigating inside the hidden iframe could be done using\n * about:blank#state instead of a real page on the server. Setting the hash on\n * about:blank creates history entries, but the hash is not recorded and is lost\n * when the user hits the back button. This is true in Opera as well. A blank\n * HTML page must be provided for invisible states to be recorded in the iframe\n * hash.\n *\n * After leaving the page with the History object and returning to it (by\n * hitting the back button from another site), the last state of the iframe is\n * overwritten. The most recent state is saved in a hidden input field so the\n * previous state can be restored.\n *\n * Firefox does not store the previous value of dynamically generated input\n * elements. To save the state, the hidden element must be in the HTML document,\n * either in the original source or added with document.write. If a reference\n * to the input element is not provided as a constructor argument, then the\n * history object creates one using document.write, in which case the history\n * object must be created from a script in the body element of the page.\n *\n * Manually editing the address field to a different hash link prevents further\n * updates to the address bar. The page continues to work as normal, but the\n * address shown will be incorrect until the page is reloaded.\n *\n * NOTE(user): It should be noted that Firefox will URL encode any non-regular\n * ascii character, along with |space|, \", <, and >, when added to the fragment.\n * If you expect these characters in your tokens you should consider that\n * setToken('<b>') would result in the history fragment \"%3Cb%3E\", and\n * \"esp&eacute;re\" would show \"esp%E8re\".  (IE allows unicode characters in the\n * fragment)\n *\n * TODO(user): Should we encapsulate this escaping into the API for visible\n * history and encode all characters that aren't supported by Firefox?  It also\n * needs to be optional so apps can elect to handle the escaping themselves.\n *\n *\n * Internet Explorer (through version 7.0):\n *\n * IE does not modify the history stack when the document fragment is changed.\n * We create history entries instead by using document.open and document.write\n * into a hidden iframe.\n *\n * IE destroys the history stack when navigating from /foo.html#someFragment to\n * /foo.html. The workaround is to always append the # to the URL. This is\n * somewhat unfortunate when loading the page without any # specified, because\n * a second \"click\" sound will play on load as the fragment is automatically\n * appended. If the hash is always present, this can be avoided.\n *\n * Manually editing the hash in the address bar in IE6 and then hitting the back\n * button can replace the page with a blank page. This is a Bad User Experience,\n * but probably not preventable.\n *\n * IE also has a bug when the page is loaded via a server redirect, setting\n * a new hash value on the window location will force a page reload. This will\n * happen the first time setToken is called with a new token. The only known\n * workaround is to force a client reload early, for example by setting\n * window.location.hash = window.location.hash, which will otherwise be a no-op.\n *\n * Internet Explorer 8.0, Webkit 532.1 and Gecko 1.9.2:\n *\n * IE8 has introduced the support to the HTML5 onhashchange event, which means\n * we don't have to do any polling to detect fragment changes. Chrome and\n * Firefox have added it on their newer builds, wekbit 532.1 and gecko 1.9.2.\n * http://www.w3.org/TR/html5/history.html\n * NOTE(goto): it is important to note that the document needs to have the\n * <!DOCTYPE html> tag to enable the IE8 HTML5 mode. If the tag is not present,\n * IE8 will enter IE7 compatibility mode (which can also be enabled manually).\n *\n * Opera (through version 9.02):\n *\n * Navigating through pages at a rate faster than some threshold causes Opera\n * to cancel all outstanding timeouts and intervals, including the location\n * polling loop. Since this condition cannot be detected, common input events\n * are captured to cause the loop to restart.\n *\n * location.replace is adding a history entry inside setHash_, despite\n * documentation that suggests it should not.\n *\n *\n * Safari (through version 2.0.4):\n *\n * After hitting the back button, the location.hash property is no longer\n * readable from JavaScript. This is fixed in later WebKit builds, but not in\n * currently shipping Safari. For now, the only recourse is to disable history\n * states in Safari. Pages are still navigable via the History object, but the\n * back button cannot restore previous states.\n *\n * Safari sets history states on navigation to a hashlink, but doesn't allow\n * polling of the hash, so following actual anchor links in the page will create\n * useless history entries. Using location.replace does not seem to prevent\n * this. Not a terribly good user experience, but fixed in later Webkits.\n *\n *\n * WebKit (nightly version 420+):\n *\n * This almost works. Returning to a page with an invisible history object does\n * not restore the old state, however, and there is no pageshow event that fires\n * in this browser. Holding off on finding a solution for now.\n *\n *\n * HTML5 capable browsers (Firefox 4, Chrome, Safari 5)\n *\n * No known issues. The goog.history.Html5History class provides a simpler\n * implementation more suitable for recent browsers. These implementations\n * should be merged so the history class automatically invokes the correct\n * implementation.\n */\n\n\ngoog.provide('goog.History');\ngoog.provide('goog.History.Event');\ngoog.provide('goog.History.EventType');\n\ngoog.require('goog.Timer');\ngoog.require('goog.asserts');\ngoog.require('goog.dom');\ngoog.require('goog.dom.InputType');\ngoog.require('goog.dom.safe');\n/** @suppress {extraRequire} */\ngoog.require('goog.events.Event');\ngoog.require('goog.events.EventHandler');\ngoog.require('goog.events.EventTarget');\ngoog.require('goog.events.EventType');\ngoog.require('goog.history.Event');\ngoog.require('goog.history.EventType');\ngoog.require('goog.html.SafeHtml');\ngoog.require('goog.html.TrustedResourceUrl');\ngoog.require('goog.html.uncheckedconversions');\ngoog.require('goog.labs.userAgent.device');\ngoog.require('goog.memoize');\ngoog.require('goog.string');\ngoog.require('goog.string.Const');\ngoog.require('goog.userAgent');\ngoog.requireType('goog.events.BrowserEvent');\n\n\n\n/**\n * A history management object. Can be instantiated in user-visible mode (uses\n * the address fragment to manage state) or in hidden mode. This object should\n * be created from a script in the document body before the document has\n * finished loading.\n *\n * To store the hidden states in browsers other than IE, a hidden iframe is\n * used. It must point to a valid html page on the same domain (which can and\n * probably should be blank.)\n *\n * Sample instantiation and usage:\n *\n * <pre>\n * // Instantiate history to use the address bar for state.\n * var h = new goog.History();\n * goog.events.listen(h, goog.history.EventType.NAVIGATE, navCallback);\n * h.setEnabled(true);\n *\n * // Any changes to the location hash will call the following function.\n * function navCallback(e) {\n *   alert('Navigated to state \"' + e.token + '\"');\n * }\n *\n * // The history token can also be set from code directly.\n * h.setToken('foo');\n * </pre>\n *\n * @param {boolean=} opt_invisible True to use hidden history states instead of\n *     the user-visible location hash.\n * @param {!goog.html.TrustedResourceUrl=} opt_blankPageUrl A URL to a\n *     blank page on the same server. Required if opt_invisible is true.\n *     This URL is also used as the src for the iframe used to track history\n *     state in IE (if not specified the iframe is not given a src attribute).\n *     Access is Denied error may occur in IE7 if the window's URL's scheme\n *     is https, and this URL is not specified.\n * @param {HTMLInputElement=} opt_input The hidden input element to be used to\n *     store the history token.  If not provided, a hidden input element will\n *     be created using document.write.\n * @param {HTMLIFrameElement=} opt_iframe The hidden iframe that will be used by\n *     IE for pushing history state changes, or by all browsers if opt_invisible\n *     is true. If not provided, a hidden iframe element will be created using\n *     document.write.\n * @constructor\n * @extends {goog.events.EventTarget}\n */\ngoog.History = function(\n    opt_invisible, opt_blankPageUrl, opt_input, opt_iframe) {\n  'use strict';\n  goog.events.EventTarget.call(this);\n\n  if (opt_invisible && !opt_blankPageUrl) {\n    throw new Error(\n        'Can\\'t use invisible history without providing a blank page.');\n  }\n\n  let input;\n  if (opt_input) {\n    input = opt_input;\n  } else {\n    const inputId = 'history_state' + goog.History.historyCount_;\n    const inputHtml = goog.html.SafeHtml.create('input', {\n      type: goog.dom.InputType.TEXT,\n      name: inputId,\n      id: inputId,\n      style: goog.string.Const.from('display:none')\n    });\n    goog.dom.safe.documentWrite(document, inputHtml);\n    input = goog.dom.getElement(inputId);\n  }\n\n  /**\n   * An input element that stores the current iframe state. Used to restore\n   * the state when returning to the page on non-IE browsers.\n   * @type {HTMLInputElement}\n   * @private\n   */\n  this.hiddenInput_ = /** @type {HTMLInputElement} */ (input);\n\n  /**\n   * The window whose location contains the history token fragment. This is\n   * the window that contains the hidden input. It's typically the top window.\n   * It is not necessarily the same window that the js code is loaded in.\n   * @type {Window}\n   * @private\n   */\n  this.window_ = opt_input ?\n      goog.dom.getWindow(goog.dom.getOwnerDocument(opt_input)) :\n      window;\n\n  /**\n   * The base URL for the hidden iframe. Must refer to a document in the\n   * same domain as the main page.\n   * @type {!goog.html.TrustedResourceUrl|undefined}\n   * @private\n   */\n  this.iframeSrc_ = opt_blankPageUrl;\n\n  if (goog.userAgent.IE && !opt_blankPageUrl) {\n    if (window.location.protocol == 'https') {\n      this.iframeSrc_ = goog.html.TrustedResourceUrl.fromConstant(\n          goog.string.Const.from('https:///'));\n    } else {\n      this.iframeSrc_ = goog.html.TrustedResourceUrl.fromConstant(\n          goog.string.Const.from('javascript:\"\"'));\n    }\n  }\n\n  /**\n   * A timer for polling the current history state for changes.\n   * @type {goog.Timer}\n   * @private\n   */\n  this.timer_ = new goog.Timer(goog.History.PollingType.NORMAL);\n  this.registerDisposable(this.timer_);\n\n  /**\n   * True if the state tokens are displayed in the address bar, false for hidden\n   * history states.\n   * @type {boolean}\n   * @private\n   */\n  this.userVisible_ = !opt_invisible;\n\n  /**\n   * An object to keep track of the history event listeners.\n   * @type {goog.events.EventHandler<!goog.History>}\n   * @private\n   */\n  this.eventHandler_ = new goog.events.EventHandler(this);\n\n  if (opt_invisible || goog.History.LEGACY_IE) {\n    let iframe;\n    if (opt_iframe) {\n      iframe = opt_iframe;\n    } else {\n      const iframeId = 'history_iframe' + goog.History.historyCount_;\n      // Using a \"sandbox\" attribute on the iframe might be possible, but\n      // this HTML didn't initially have it and when it was refactored\n      // to SafeHtml it was kept without it.\n      const iframeHtml =\n          goog.html.SafeHtml.createIframe(this.iframeSrc_, null, {\n            id: iframeId,\n            style: goog.string.Const.from('display:none'),\n            sandbox: undefined\n          });\n      goog.dom.safe.documentWrite(document, iframeHtml);\n      iframe = goog.dom.getElement(iframeId);\n    }\n\n    /**\n     * Internet Explorer uses a hidden iframe for all history changes. Other\n     * browsers use the iframe only for pushing invisible states.\n     * @type {HTMLIFrameElement}\n     * @private\n     */\n    this.iframe_ = /** @type {HTMLIFrameElement} */ (iframe);\n\n    /**\n     * Whether the hidden iframe has had a document written to it yet in this\n     * session.\n     * @type {boolean}\n     * @private\n     */\n    this.unsetIframe_ = true;\n  }\n\n  if (goog.History.LEGACY_IE) {\n    // IE relies on the hidden input to restore the history state from previous\n    // sessions, but input values are only restored after window.onload. Set up\n    // a callback to poll the value after the onload event.\n    this.eventHandler_.listen(\n        this.window_, goog.events.EventType.LOAD, this.onDocumentLoaded);\n\n    /**\n     * IE-only variable for determining if the document has loaded.\n     * @type {boolean}\n     * @protected\n     */\n    this.documentLoaded = false;\n\n    /**\n     * IE-only variable for storing whether the history object should be enabled\n     * once the document finishes loading.\n     * @type {boolean}\n     * @private\n     */\n    this.shouldEnable_ = false;\n  }\n\n  // Set the initial history state.\n  if (this.userVisible_) {\n    this.setHash_(this.getToken(), true);\n  } else {\n    this.setIframeToken_(this.hiddenInput_.value);\n  }\n\n  goog.History.historyCount_++;\n};\ngoog.inherits(goog.History, goog.events.EventTarget);\n\n\n/**\n * Status of when the object is active and dispatching events.\n * @type {boolean}\n * @private\n */\ngoog.History.prototype.enabled_ = false;\n\n\n/**\n * Whether the object is performing polling with longer intervals. This can\n * occur for instance when setting the location of the iframe when in invisible\n * mode and the server that is hosting the blank html page is down. In FF, this\n * will cause the location of the iframe to no longer be accessible, with\n * permision denied exceptions being thrown on every access of the history\n * token. When this occurs, the polling interval is elongated. This causes\n * exceptions to be thrown at a lesser rate while allowing for the history\n * object to resurrect itself when the html page becomes accessible.\n * @type {boolean}\n * @private\n */\ngoog.History.prototype.longerPolling_ = false;\n\n\n/**\n * The last token set by the history object, used to poll for changes.\n * @type {?string}\n * @private\n */\ngoog.History.prototype.lastToken_ = null;\n\n\n/**\n * Whether the browser supports HTML5 history management's onhashchange event.\n * {@link http://www.w3.org/TR/html5/history.html}. IE 9 in compatibility mode\n * indicates that onhashchange is in window, but testing reveals the event\n * isn't actually fired.\n * @return {boolean} Whether onhashchange is supported.\n */\ngoog.History.isOnHashChangeSupported = goog.memoize(function() {\n  'use strict';\n  return goog.userAgent.IE ? goog.userAgent.isDocumentModeOrHigher(8) :\n                             'onhashchange' in goog.global;\n});\n\n\n/**\n * Whether the current browser is Internet Explorer prior to version 8. Many IE\n * specific workarounds developed before version 8 are unnecessary in more\n * current versions.\n * @type {boolean}\n */\ngoog.History.LEGACY_IE =\n    goog.userAgent.IE && !goog.userAgent.isDocumentModeOrHigher(8);\n\n\n/**\n * Whether the browser always requires the hash to be present. Internet Explorer\n * before version 8 will reload the HTML page if the hash is omitted.\n * @type {boolean}\n */\ngoog.History.HASH_ALWAYS_REQUIRED = goog.History.LEGACY_IE;\n\n\n/**\n * If not null, polling in the user invisible mode will be disabled until this\n * token is seen. This is used to prevent a race condition where the iframe\n * hangs temporarily while the location is changed.\n * @type {?string}\n * @private\n */\ngoog.History.prototype.lockedToken_ = null;\n\n\n/** @override */\ngoog.History.prototype.disposeInternal = function() {\n  'use strict';\n  goog.History.superClass_.disposeInternal.call(this);\n  this.eventHandler_.dispose();\n  this.setEnabled(false);\n};\n\n\n/**\n * Starts or stops the History polling loop. When enabled, the History object\n * will immediately fire an event for the current location. The caller can set\n * up event listeners between the call to the constructor and the call to\n * setEnabled.\n *\n * On IE, actual startup may be delayed until the iframe and hidden input\n * element have been loaded and can be polled. This behavior is transparent to\n * the caller.\n *\n * @param {boolean} enable Whether to enable the history polling loop.\n */\ngoog.History.prototype.setEnabled = function(enable) {\n  'use strict';\n  if (enable == this.enabled_) {\n    return;\n  }\n\n  if (goog.History.LEGACY_IE && !this.documentLoaded) {\n    // Wait until the document has actually loaded before enabling the\n    // object or any saved state from a previous session will be lost.\n    this.shouldEnable_ = enable;\n    return;\n  }\n\n  if (enable) {\n    if (goog.userAgent.GECKO) {\n      // Firefox will not restore the correct state after navigating away from\n      // and then back to the page with the history object. This can be fixed\n      // by restarting the history object on the pageshow event.\n      this.eventHandler_.listen(this.window_, 'pageshow', this.onShow_);\n    }\n\n    // TODO(goto): make HTML5 and invisible history work by listening to the\n    // iframe # changes instead of the window.\n    if (goog.History.isOnHashChangeSupported() && this.userVisible_) {\n      this.eventHandler_.listen(\n          this.window_, goog.events.EventType.HASHCHANGE, this.onHashChange_);\n      this.enabled_ = true;\n      this.dispatchEvent(new goog.history.Event(this.getToken(), false));\n    } else if (\n        !(goog.userAgent.IE && !goog.labs.userAgent.device.isMobile()) ||\n        this.documentLoaded) {\n      // Start dispatching history events if all necessary loading has\n      // completed (always true for browsers other than IE.)\n      this.eventHandler_.listen(\n          this.timer_, goog.Timer.TICK, goog.bind(this.check_, this, true));\n\n      this.enabled_ = true;\n\n      // Initialize last token at startup except on IE < 8, where the last token\n      // must only be set in conjunction with IFRAME updates, or the IFRAME will\n      // start out of sync and remove any pre-existing URI fragment.\n      if (!goog.History.LEGACY_IE) {\n        this.lastToken_ = this.getToken();\n        this.dispatchEvent(new goog.history.Event(this.getToken(), false));\n      }\n\n      this.timer_.start();\n    }\n\n  } else {\n    this.enabled_ = false;\n    this.eventHandler_.removeAll();\n    this.timer_.stop();\n  }\n};\n\n\n/**\n * Callback for the window onload event in IE. This is necessary to read the\n * value of the hidden input after restoring a history session. The value of\n * input elements is not viewable until after window onload for some reason (the\n * iframe state is similarly unavailable during the loading phase.)  If\n * setEnabled is called before the iframe has completed loading, the history\n * object will actually be enabled at this point.\n * @protected\n */\ngoog.History.prototype.onDocumentLoaded = function() {\n  'use strict';\n  this.documentLoaded = true;\n\n  if (this.hiddenInput_.value) {\n    // Any saved value in the hidden input can only be read after the document\n    // has been loaded due to an IE limitation. Restore the previous state if\n    // it has been set.\n    this.setIframeToken_(this.hiddenInput_.value, true);\n  }\n\n  this.setEnabled(this.shouldEnable_);\n};\n\n\n/**\n * Handler for the Gecko pageshow event. Restarts the history object so that the\n * correct state can be restored in the hash or iframe.\n * @param {goog.events.BrowserEvent} e The browser event.\n * @private\n */\ngoog.History.prototype.onShow_ = function(e) {\n  'use strict';\n  // NOTE(user): persisted is a property passed in the pageshow event that\n  // indicates whether the page is being persisted from the cache or is being\n  // loaded for the first time.\n  if (e.getBrowserEvent()['persisted']) {\n    this.setEnabled(false);\n    this.setEnabled(true);\n  }\n};\n\n\n/**\n * Handles HTML5 onhashchange events on browsers where it is supported.\n * This is very similar to {@link #check_}, except that it is not executed\n * continuously. It is only used when\n * `goog.History.isOnHashChangeSupported()` is true.\n * @param {goog.events.BrowserEvent} e The browser event.\n * @private\n */\ngoog.History.prototype.onHashChange_ = function(e) {\n  'use strict';\n  const hash = this.getLocationFragment_(this.window_);\n  if (hash != this.lastToken_) {\n    this.update_(hash, true);\n  }\n};\n\n\n/**\n * @return {string} The current token.\n */\ngoog.History.prototype.getToken = function() {\n  'use strict';\n  if (this.lockedToken_ != null) {\n    return this.lockedToken_;\n  } else if (this.userVisible_) {\n    return this.getLocationFragment_(this.window_);\n  } else {\n    return this.getIframeToken_() || '';\n  }\n};\n\n\n/**\n * Sets the history state. When user visible states are used, the URL fragment\n * will be set to the provided token.  Sometimes it is necessary to set the\n * history token before the document title has changed, in this case IE's\n * history drop down can be out of sync with the token.  To get around this\n * problem, the app can pass in a title to use with the hidden iframe.\n * @param {string} token The history state identifier.\n * @param {string=} opt_title Optional title used when setting the hidden iframe\n *     title in IE.\n */\ngoog.History.prototype.setToken = function(token, opt_title) {\n  'use strict';\n  this.setHistoryState_(token, false, opt_title);\n};\n\n\n/**\n * Replaces the current history state without affecting the rest of the history\n * stack.\n * @param {string} token The history state identifier.\n * @param {string=} opt_title Optional title used when setting the hidden iframe\n *     title in IE.\n */\ngoog.History.prototype.replaceToken = function(token, opt_title) {\n  'use strict';\n  this.setHistoryState_(token, true, opt_title);\n};\n\n\n/**\n * Gets the location fragment for the current URL.  We don't use location.hash\n * directly as the browser helpfully urlDecodes the string for us which can\n * corrupt the tokens.  For example, if we want to store: label/%2Froot it would\n * be returned as label//root.\n * @param {Window} win The window object to use.\n * @return {string} The fragment.\n * @private\n */\ngoog.History.prototype.getLocationFragment_ = function(win) {\n  'use strict';\n  const href = win.location.href;\n  const index = href.indexOf('#');\n  return index < 0 ? '' : href.substring(index + 1);\n};\n\n\n/**\n * Sets the history state. When user visible states are used, the URL fragment\n * will be set to the provided token. Setting opt_replace to true will cause the\n * navigation to occur, but will replace the current history entry without\n * affecting the length of the stack.\n *\n * @param {string} token The history state identifier.\n * @param {boolean} replace Set to replace the current history entry instead of\n *    appending a new history state.\n * @param {string=} opt_title Optional title used when setting the hidden iframe\n *     title in IE.\n * @private\n */\ngoog.History.prototype.setHistoryState_ = function(token, replace, opt_title) {\n  'use strict';\n  if (this.getToken() != token) {\n    if (this.userVisible_) {\n      this.setHash_(token, replace);\n\n      if (!goog.History.isOnHashChangeSupported()) {\n        if (goog.userAgent.IE && !goog.labs.userAgent.device.isMobile()) {\n          // IE must save state using the iframe.\n          this.setIframeToken_(token, replace, opt_title);\n        }\n      }\n\n      // This condition needs to be called even if\n      // goog.History.isOnHashChangeSupported() is true so the NAVIGATE event\n      // fires sychronously.\n      if (this.enabled_) {\n        this.check_(false);\n      }\n    } else {\n      // Fire the event immediately so that setting history is synchronous, but\n      // set a suspendToken so that polling doesn't trigger a 'back'.\n      this.setIframeToken_(token, replace);\n      this.lockedToken_ = this.lastToken_ = this.hiddenInput_.value = token;\n      this.dispatchEvent(new goog.history.Event(token, false));\n    }\n  }\n};\n\n\n/**\n * Sets or replaces the URL fragment. The token does not need to be URL encoded\n * according to the URL specification, though certain characters (like newline)\n * are automatically stripped.\n *\n * If opt_replace is not set, non-IE browsers will append a new entry to the\n * history list. Setting the hash does not affect the history stack in IE\n * (unless there is a pre-existing named anchor for that hash.)\n *\n * Older versions of Webkit cannot query the location hash, but it still can be\n * set. If we detect one of these versions, always replace instead of creating\n * new history entries.\n *\n * window.location.replace replaces the current state from the history stack.\n * http://www.whatwg.org/specs/web-apps/current-work/#dom-location-replace\n * http://www.whatwg.org/specs/web-apps/current-work/#replacement-enabled\n *\n * @param {string} token The new string to set.\n * @param {boolean=} opt_replace Set to true to replace the current token\n *    without appending a history entry.\n * @private\n */\ngoog.History.prototype.setHash_ = function(token, opt_replace) {\n  'use strict';\n  // If the page uses a BASE element, setting location.hash directly will\n  // navigate away from the current document. Also, the original URL path may\n  // possibly change from HTML5 history pushState. To account for these, the\n  // full path is always specified.\n  const loc = this.window_.location;\n  let url = loc.href.split('#')[0];\n\n  // If a hash has already been set, then removing it programmatically will\n  // reload the page. Once there is a hash, we won't remove it.\n  const hasHash = goog.string.contains(loc.href, '#');\n\n  if (goog.History.HASH_ALWAYS_REQUIRED || hasHash || token) {\n    url += '#' + token;\n  }\n\n  if (url != loc.href) {\n    const safeUrl =\n        goog.html.uncheckedconversions\n            .safeUrlFromStringKnownToSatisfyTypeContract(\n                goog.string.Const.from('URL taken from location.href.'), url);\n    if (opt_replace) {\n      goog.dom.safe.replaceLocation(loc, safeUrl);\n    } else {\n      goog.dom.safe.setLocationHref(loc, safeUrl);\n    }\n  }\n};\n\n\n/**\n * Sets the hidden iframe state. On IE, this is accomplished by writing a new\n * document into the iframe. In Firefox, the iframe's URL fragment stores the\n * state instead.\n *\n * Older versions of webkit cannot set the iframe, so ignore those browsers.\n *\n * @param {string} token The new string to set.\n * @param {boolean=} opt_replace Set to true to replace the current iframe state\n *     without appending a new history entry.\n * @param {string=} opt_title Optional title used when setting the hidden iframe\n *     title in IE.\n * @private\n */\ngoog.History.prototype.setIframeToken_ = function(\n    token, opt_replace, opt_title) {\n  'use strict';\n  if (this.unsetIframe_ || token != this.getIframeToken_()) {\n    this.unsetIframe_ = false;\n    token = goog.string.urlEncode(token);\n\n    if (goog.userAgent.IE) {\n      // Caching the iframe document results in document permission errors after\n      // leaving the page and returning. Access it anew each time instead.\n      const doc = goog.dom.getFrameContentDocument(this.iframe_);\n\n      doc.open('text/html', opt_replace ? 'replace' : undefined);\n      const iframeSourceHtml = goog.html.SafeHtml.concat(\n          goog.html.SafeHtml.create(\n              'title', {}, (opt_title || this.window_.document.title)),\n          goog.html.SafeHtml.create('body', {}, token));\n      goog.dom.safe.documentWrite(doc, iframeSourceHtml);\n      doc.close();\n    } else {\n      goog.asserts.assertInstanceof(\n          this.iframeSrc_, goog.html.TrustedResourceUrl,\n          'this.iframeSrc_ must be set on calls to setIframeToken_');\n      const url =\n          goog.html.TrustedResourceUrl.unwrap(\n              /** @type {!goog.html.TrustedResourceUrl} */ (this.iframeSrc_)) +\n          '#' + token;\n\n      // In Safari, it is possible for the contentWindow of the iframe to not\n      // be present when the page is loading after a reload.\n      const contentWindow = this.iframe_.contentWindow;\n      if (contentWindow) {\n        if (opt_replace) {\n          goog.dom.safe.replaceLocation(contentWindow.location, url);\n        } else {\n          goog.dom.safe.setLocationHref(contentWindow.location, url);\n        }\n      }\n    }\n  }\n};\n\n\n/**\n * Return the current state string from the hidden iframe. On internet explorer,\n * this is stored as a string in the document body. Other browsers use the\n * location hash of the hidden iframe.\n *\n * Older versions of webkit cannot access the iframe location, so always return\n * null in that case.\n *\n * @return {?string} The state token saved in the iframe (possibly null if the\n *     iframe has never loaded.).\n * @private\n */\ngoog.History.prototype.getIframeToken_ = function() {\n  'use strict';\n  if (goog.userAgent.IE) {\n    const doc = goog.dom.getFrameContentDocument(this.iframe_);\n    return doc.body ? goog.string.urlDecode(doc.body.innerHTML) : null;\n  } else {\n    // In Safari, it is possible for the contentWindow of the iframe to not\n    // be present when the page is loading after a reload.\n    const contentWindow = this.iframe_.contentWindow;\n    if (contentWindow) {\n      let hash;\n\n      try {\n        // Iframe tokens are urlEncoded\n        hash = goog.string.urlDecode(this.getLocationFragment_(contentWindow));\n      } catch (e) {\n        // An exception will be thrown if the location of the iframe can not be\n        // accessed (permission denied). This can occur in FF if the server\n        // that is hosting the blank html page goes down and then a new history\n        // token is set. The iframe will navigate to an error page, and the\n        // location of the iframe can no longer be accessed. Due to the polling,\n        // this will cause constant exceptions to be thrown. In this case,\n        // we enable longer polling. We do not have to attempt to reset the\n        // iframe token because (a) we already fired the NAVIGATE event when\n        // setting the token, (b) we can rely on the locked token for current\n        // state, and (c) the token is still in the history and\n        // accesible on forward/back.\n        if (!this.longerPolling_) {\n          this.setLongerPolling_(true);\n        }\n\n        return null;\n      }\n\n      // There was no exception when getting the hash so turn off longer polling\n      // if it is on.\n      if (this.longerPolling_) {\n        this.setLongerPolling_(false);\n      }\n\n      return hash || null;\n    } else {\n      return null;\n    }\n  }\n};\n\n\n/**\n * Checks the state of the document fragment and the iframe title to detect\n * navigation changes. If `goog.HistoryisOnHashChangeSupported()` is\n * `false`, then this runs approximately twenty times per second.\n * @param {boolean} isNavigation True if the event was initiated by a browser\n *     action, false if it was caused by a setToken call. See\n *     {@link goog.history.Event}.\n * @private\n */\ngoog.History.prototype.check_ = function(isNavigation) {\n  'use strict';\n  if (this.userVisible_) {\n    const hash = this.getLocationFragment_(this.window_);\n    if (hash != this.lastToken_) {\n      this.update_(hash, isNavigation);\n    }\n  }\n\n  // Old IE uses the iframe for both visible and non-visible versions.\n  if (!this.userVisible_ || goog.History.LEGACY_IE) {\n    const token = this.getIframeToken_() || '';\n    if (this.lockedToken_ == null || token == this.lockedToken_) {\n      this.lockedToken_ = null;\n      if (token != this.lastToken_) {\n        this.update_(token, isNavigation);\n      }\n    }\n  }\n};\n\n\n/**\n * Updates the current history state with a given token. Called after a change\n * to the location or the iframe state is detected by poll_.\n *\n * @param {string} token The new history state.\n * @param {boolean} isNavigation True if the event was initiated by a browser\n *     action, false if it was caused by a setToken call. See\n *     {@link goog.history.Event}.\n * @private\n */\ngoog.History.prototype.update_ = function(token, isNavigation) {\n  'use strict';\n  this.lastToken_ = this.hiddenInput_.value = token;\n\n  if (this.userVisible_) {\n    if (goog.History.LEGACY_IE) {\n      this.setIframeToken_(token);\n    }\n\n    this.setHash_(token);\n  } else {\n    this.setIframeToken_(token);\n  }\n\n  this.dispatchEvent(new goog.history.Event(this.getToken(), isNavigation));\n};\n\n\n/**\n * Sets if the history oject should use longer intervals when polling.\n *\n * @param {boolean} longerPolling Whether to enable longer polling.\n * @private\n */\ngoog.History.prototype.setLongerPolling_ = function(longerPolling) {\n  'use strict';\n  if (this.longerPolling_ != longerPolling) {\n    this.timer_.setInterval(\n        longerPolling ? goog.History.PollingType.LONG :\n                        goog.History.PollingType.NORMAL);\n  }\n  this.longerPolling_ = longerPolling;\n};\n\n\n/**\n * Opera cancels all outstanding timeouts and intervals after any rapid\n * succession of navigation events, including the interval used to detect\n * navigation events. This function restarts the interval so that navigation can\n * continue. Ideally, only events which would be likely to cause a navigation\n * change (mousedown and keydown) would be bound to this function. Since Opera\n * seems to ignore keydown events while the alt key is pressed (such as\n * alt-left or right arrow), this function is also bound to the much more\n * frequent mousemove event. This way, when the update loop freezes, it will\n * unstick itself as the user wiggles the mouse in frustration.\n * @private\n */\ngoog.History.prototype.operaDefibrillator_ = function() {\n  'use strict';\n  this.timer_.stop();\n  this.timer_.start();\n};\n\n\n/**\n * List of user input event types registered in Opera to restart the history\n * timer (@see goog.History#operaDefibrillator_).\n * @type {Array<string>}\n * @private\n */\ngoog.History.INPUT_EVENTS_ = [\n  goog.events.EventType.MOUSEDOWN, goog.events.EventType.KEYDOWN,\n  goog.events.EventType.MOUSEMOVE\n];\n\n\n/**\n * Counter for the number of goog.History objects that have been instantiated.\n * Used to create unique IDs.\n * @type {number}\n * @private\n */\ngoog.History.historyCount_ = 0;\n\n\n/**\n * Types of polling. The values are in ms of the polling interval.\n * @enum {number}\n */\ngoog.History.PollingType = {\n  NORMAL: 150,\n  LONG: 10000\n};\n\n\n/**\n * Constant for the history change event type.\n * @enum {string}\n * @deprecated Use goog.history.EventType.\n */\ngoog.History.EventType = goog.history.EventType;\n\n\n\n/**\n * Constant for the history change event type.\n * @constructor\n * @deprecated Use goog.history.Event.\n * @final\n */\ngoog.History.Event = goog.history.Event;\n"],
"names":["goog","provide","require","requireType","History","goog.History","opt_invisible","opt_blankPageUrl","opt_input","opt_iframe","events","EventTarget","call","Error","input","inputId","historyCount_","inputHtml","html","SafeHtml","create","type","dom","InputType","TEXT","name","id","style","string","Const","from","safe","documentWrite","document","getElement","hiddenInput_","window_","getWindow","getOwnerDocument","window","iframeSrc_","userAgent","IE","location","protocol","TrustedResourceUrl","fromConstant","timer_","Timer","PollingType","NORMAL","registerDisposable","userVisible_","eventHandler_","EventHandler","LEGACY_IE","iframe","iframeId","iframeHtml","createIframe","sandbox","undefined","iframe_","unsetIframe_","listen","EventType","LOAD","onDocumentLoaded","documentLoaded","shouldEnable_","setHash_","getToken","setIframeToken_","value","inherits","prototype","enabled_","longerPolling_","lastToken_","isOnHashChangeSupported","memoize","isDocumentModeOrHigher","global","HASH_ALWAYS_REQUIRED","lockedToken_","disposeInternal","goog.History.prototype.disposeInternal","superClass_","dispose","setEnabled","goog.History.prototype.setEnabled","enable","GECKO","onShow_","HASHCHANGE","onHashChange_","dispatchEvent","history","Event","labs","device","isMobile","TICK","bind","check_","start","removeAll","stop","goog.History.prototype.onDocumentLoaded","goog.History.prototype.onShow_","e","getBrowserEvent","goog.History.prototype.onHashChange_","hash","getLocationFragment_","update_","goog.History.prototype.getToken","getIframeToken_","setToken","goog.History.prototype.setToken","token","opt_title","setHistoryState_","replaceToken","goog.History.prototype.replaceToken","goog.History.prototype.getLocationFragment_","win","href","index","indexOf","substring","goog.History.prototype.setHistoryState_","replace","goog.History.prototype.setHash_","opt_replace","loc","url","split","hasHash","contains","safeUrl","uncheckedconversions","safeUrlFromStringKnownToSatisfyTypeContract","replaceLocation","setLocationHref","goog.History.prototype.setIframeToken_","urlEncode","doc","getFrameContentDocument","open","iframeSourceHtml","concat","title","close","asserts","assertInstanceof","unwrap","contentWindow","goog.History.prototype.getIframeToken_","body","urlDecode","innerHTML","setLongerPolling_","goog.History.prototype.check_","isNavigation","goog.History.prototype.update_","goog.History.prototype.setLongerPolling_","longerPolling","setInterval","LONG","operaDefibrillator_","goog.History.prototype.operaDefibrillator_","INPUT_EVENTS_","MOUSEDOWN","KEYDOWN","MOUSEMOVE"]
}
