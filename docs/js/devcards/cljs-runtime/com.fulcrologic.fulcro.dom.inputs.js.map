{"version":3,"sources":["com/fulcrologic/fulcro/dom/inputs.cljc"],"mappings":"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","names":["p__49701","map__49702","cljs.core/--destructure-map","cljs.core.get","com.fulcrologic.fulcro.dom.inputs/StringBufferedInput","kw","model->string","string->model","string-filter","cls","props","this","map__49704","com.fulcrologic.fulcro.dom.inputs.goog$module$goog$object.get","value","initial-state","evt","map__49706","onChange","com.fulcrologic.fulcro.components/props","nsv","com.fulcrologic.fulcro.dom.events/target-value","nv","com.fulcrologic.fulcro.components.set_state_BANG_","and__4251__auto__","cljs.core.not_EQ_","obj49710","com.fulcrologic.fulcro.components/configure-component!","latest-props","state","map__49716","map__49717","oldPropValue","stringValue","ignorePropValue?","cljs.core._EQ_","G__49723","new-derived-state","cljs.core.merge","map__49728","map__49729","onBlur","on-change","com.fulcrologic.fulcro.components.get_state","js/React.createElement","cljs.core/clj->js","G__49730","cljs.core.assoc","G__49731","G__49732","com.fulcrologic.fulcro.components/register-component!","com.fulcrologic.fulcro.dom.inputs/symbol-chars","s","clojure.string/replace","com.fulcrologic.fulcro.dom.inputs/ui-keyword-input","com.fulcrologic.fulcro.components.factory","p1__49737#","p1__49738#","G__49746","cljs.core/name","cljs.core/seq","G__49747","cljs.core.keyword","com.fulcrologic.fulcro.dom.inputs/to-int","n","js/parseInt","js/isNaN","digits","cljs.core.into","cljs.core.map","cljs.core/str","cljs.core.range","com.fulcrologic.fulcro.dom.inputs/just-digits","clojure.string.join","cljs.core.filter","com.fulcrologic.fulcro.dom.inputs/ui-int-input"],"sourcesContent":["(ns com.fulcrologic.fulcro.dom.inputs\n  \"A namespace for dealing with inputs in HTML DOM when you wish to control a value in the data model\n  that cannot be directly represented by normal HTML inputs (which always use strings). For example, you want to have an int in\n  your data model, but HTML5 number inputs return a string. The primary utility is `StringBufferedInput` which generates\n  a new React class that wraps an HTML `input`. The namespace also includes a few uses that are handy (at least as\n  examples): `ui-int-input` and `ui-keyword-input`. See the source of those for examples.\"\n  (:require\n    #?@(:cljs\n        [[cljsjs.react]\n         [goog.object :as gobj]])\n    [clojure.string :as str]\n    [com.fulcrologic.fulcro.components :as comp]\n    [com.fulcrologic.fulcro.dom.events :as evt]))\n\n(defn StringBufferedInput\n  \"Create a new type of input that can be derived from a string. `kw` is a fully-qualified keyword name for the new\n  class (which will be used to register it in the component registry), and `model->string` and `string->model` are\n  functions that can do the conversions (and MUST tolerate nil as input).\n  `model->string` MUST return a string (empty if invalid), and `string->model` should return nil if the string doesn't\n  yet convert to a valid model value.\n\n  `string-filter` is an optional `(fn [string?] string?)` that can be used to rewrite incoming strings (i.e. filter\n  things).\n  \"\n  [kw {:keys [model->string\n              string->model\n              string-filter]}]\n  (let [cls (fn [props]\n              #?(:cljs\n                 (cljs.core/this-as this\n                   (let [props         (gobj/get props \"fulcro$value\")\n                         {:keys [value]} props\n                         initial-state {:oldPropValue value\n                                        :on-change    (fn [evt]\n                                                        (let [{:keys [value onChange]} (comp/props this)\n                                                              nsv (evt/target-value evt)\n                                                              nv  (string->model nsv)]\n                                                          (comp/set-state! this {:stringValue  nsv\n                                                                                 :oldPropValue value\n                                                                                 :value        nv})\n                                                          (when (and onChange (not= value nv))\n                                                            (onChange nv))))\n                                        :stringValue  (model->string value)}]\n                     (set! (.-state this) (cljs.core/js-obj \"fulcro$state\" initial-state)))\n                   nil)))]\n    (comp/configure-component! cls kw\n      {:getDerivedStateFromProps\n       (fn [latest-props state]\n         (let [{:keys [value]} latest-props\n               {:keys [oldPropValue stringValue]} state\n               ignorePropValue?  (or (= oldPropValue value) (= value (:value state)))\n               stringValue       (cond-> (if ignorePropValue?\n                                           stringValue\n                                           (model->string value))\n                                   string-filter string-filter)\n               new-derived-state (merge state {:stringValue stringValue :oldPropValue value})]\n           #js {\"fulcro$state\" new-derived-state}))\n       :render\n       (fn [this]\n         #?(:cljs\n            (let [{:keys [value onBlur] :as props} (comp/props this)\n                  {:keys [stringValue on-change]} (comp/get-state this)]\n              (js/React.createElement \"input\"\n                (clj->js\n                  (merge props\n                    (cond->\n                      {:value    stringValue\n                       :onChange on-change}\n                      onBlur (assoc :onBlur (fn [evt]\n                                              (onBlur (-> evt evt/target-value string->model)))))))))))})\n    (comp/register-component! kw cls)\n    cls))\n\n(defn symbol-chars\n  \"Returns `s` with all non-digits stripped.\"\n  [s]\n  (str/replace s #\"[\\s\\t:]\" \"\"))\n\n(def ui-keyword-input\n  \"A keyword input. Used just like a DOM input, but requires you supply nil or a keyword for `:value`, and\n   will send a keyword to `onChange` and `onBlur`. Any other attributes in props are passed directly to the\n   underlying `dom/input`.\"\n  (comp/factory (StringBufferedInput ::KeywordInput {:model->string #(str (some-> % name))\n                                                     :string-filter symbol-chars\n                                                     :string->model #(when (seq %)\n                                                                       (some-> % keyword))})))\n(defn to-int\n  \"Convert a string `s`\"\n  [s]\n  #?(:clj\n     (try\n       (Long/parseLong s)\n       (catch Exception _\n         nil))\n     :cljs\n     (let [n (js/parseInt s)]\n       (when-not (js/isNaN n)\n         n))))\n\n(let [digits (into #{} (map str) (range 10))]\n  (defn just-digits\n    \"Returns `s` with all non-digits stripped.\"\n    [s]\n    (str/join\n      (filter digits (seq s)))))\n\n(def ui-int-input\n  \"An integer input. Can be used like `dom/input` but onChange and onBlur handlers will be passed an int instead of\n  a raw react event, and you should supply an int for `:value` instead of a string.  You may set the `:type` to text\n  or number depending on how you want the control to display, even though the model value is always an int or nil.\n  All other attributes passed in props are passed through to the contained `dom/input`.\"\n  (comp/factory (StringBufferedInput ::IntInput {:model->string str\n                                                 :string->model to-int\n                                                 :string-filter just-digits})))\n\n"]}